#!/bin/bash

#
# GENERATED FILE. DO NOT EDIT
#


if [ "$1" == "{{m.cluster.id}}" ]
then
    echo
    echo -n "----------- Will delete cluster {{m.cluster.id}}. Are you sure (yes/no): "
    read a
    if [ "$a" == "yes" ]
    then
        echo "Lets go.."
{% for node in m.cluster.nodes %}

		echo "========================================== Will delete {{node.vmname}}"
        {{m.data.kvmScriptsPath}}/deleteVM.sh --host {{m.infra.hostByName[node.host].fqdn}} --name {{node.vmname}}
        echo "---- Will delete root disk of node {{node.name}}"
        {{m.data.kvmScriptsPath}}/deleteDisk.sh --host {{m.infra.hostByName[node.host].fqdn}} --name {{node.vmname}} --volume {{node.rootVolume}} --device vda
{% if m.data.dataDisksByNode[node.name] is defined %}
		echo "---- Will delete Data disk(s) for node {{node.name}}"
{%     for disk in m.data.dataDisksByNode[node.name] %}
		{{m.data.kvmScriptsPath}}/deleteDisk.sh --host {{m.infra.hostByName[node.host].fqdn}} --name {{node.vmname}} --volume {{disk.volume}} --device {{disk.device}}
{%     endfor %}
{% else %}
		echo "---- No Data disk for node {{node.name}}"
{% endif -%}
        
{% endfor %}
    fi
else
    echo 
    echo "To really delete the cluster, as a security, please provide cluster_id as parameter"
fi

